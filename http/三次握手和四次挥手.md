
## TCP

### 1、概念

  `TCP(Transmission Control Protocol)`

  当应用层向`TCP`层发送用于网络间传输的、用8位字节表示的数据流，TCP则把数据流分割成适当的长度的报文段，传送给IP层，由它来通过网络将包传送给接受端实体的TCP层

  - ACK： 确认序号有效
  
  - SYN：发起一个新的连接

  - FIN: 释放一个连接

### 2、三次握手

 TCP的三次握手的过程如下：

 - 客户端发送`SYN`报文给服务端，进入`SYN_SEND`状态

 - 服务端手段`SYN`报文后，回应一个`SYN+ACK`的报文，进入`SYN_RECV`状态

 - 客户端收到服务器端的SYN报文，回应一个`ACK`报文，进入`Established`状态

 示意图:

  <img src="images/三次握手.jpg">

### 3、四次挥手

 - 客户端发送`FIN=1`请求关闭报文，进入`FIN-WAIT-1`阶段，停止向服务器发送数据，但可以接受

 - 服务器接受到报文后返回`ACK`确认报文，结束`ESTABELISHED`阶段，进入`CLOSE-WAIT`阶段，接到`ACK`报文后，客户端结束`FIN-WAIT-1`阶段，进入`FIN-WIN-2`阶段

 - 服务器端经过`CLOSED-WAIT`阶段，做好了释放准备，发送`FIN+ACK`，进入`LAST-ACK`阶段，停止向客户端发送数据

 - 客户端结束`FIN-WAIT-2`阶段，进入`TIME-WAIT`阶段，向服务器发送`ACK`，进入`2MSL`，等待完毕后结束`TIME-WAIT`阶段，结束连接

  示意图:

  <img src="images/四次挥手阶段.jpg">

### 4、为什么连接是三次，关闭是四次

- 连接时：`SYN`建立连接报文和`ACK`服务端确认接受报文是在同一次（`第二次`）握手中完成

- 关闭时：`FIN`请求关闭报文和`ACK`确认接受报文是分开的（`第二步`、`第三步`）,`最关键的是服务端还有必要的数据要处理，所以先返回ACK确认报文，经过CLOSE-WAIT阶段准备好释放连接的准备后，再返回FIN释放连接的报文`








